# 地面站

[![Codacy Badge](https://api.codacy.com/project/badge/Grade/090e9b44b3934c0483ee238f9ae0fdff)](https://app.codacy.com/gh/xdu-aero-association/GroundStation?utm_source=github.com&utm_medium=referral&utm_content=xdu-aero-association/GroundStation&utm_campaign=Badge_Grade_Dashboard)

c#上位机

版本 v1.00

## 使用说明
有基本收发、飞行控制、参数设置、波形显示4个标签。

可自动识别可用端口号。

[飞行器控制示例](https://github.com/xd15zhn/drone)

### 基本收发
3个发送窗口独立。第一个支持定时发送。前两个为多行，第三个为单行。

### 飞行控制
点击"建立控制链路"按钮开始以100ms间隔发送遥控帧,如果收到正确的帧则飞行状态显示"控制中"。

锁定/解锁与飞行模式切换均需要正确的密码。

解锁前需要建立控制链路。

发送切换模式指令时同步发送锁定指令。

### 参数设置
参数名称为自定义，重启软件所有名称不会丢失。

点击读取参数按钮会将从下位机收到的参数读取至文本框中，点击写入参数会将从下位机收到的参数展示到旁边。

一般来说参数传输值是参数真实值的1000倍。

### 波形显示
波形显示的数据与'参数设置'标签中的状态参数相同。

更改选择显示的数据会清空并重新显示。

## 协议
协议说明:

SUM等于从该数据帧第一字节开始，也就是帧头开始，至该帧数据的最后一字节所有字节的和的最低位字节。

协议中长度字节表示该数据帧内包含数据的字节总长度，不包括帧头、功能字、长度字节和最后的校验位，只是数据的字节长度和。

3E、3C分别为">"、"<"的ASCII值。

### 飞控->地面站

|帧名称  |帧头|功能字|长度|数据  |校验|备注|
|-       |-   |-     |-   |-     |-   |- |
|状态    |3E  |01    |03  |u8,u16|SUM |飞机状态(stat)/电压(乘1000取整)|
|姿态    |3E  |02    |06  |s16×3 |SUM |飞机姿态,roll/pitch/yaw数据各乘100|
|传感器  |3E  |04    |0C  |s16×6 |SUM |分别为陀螺仪和加速度计原始数据|
|遥控    |3E  |08    |08  |s16×4 |SUM |遥控器4个通道的控制信号|
|油门    |3E  |10    |08  |s16×4 |SUM |分别为4个电机的油门大小|
|四元数  |3E  |20    |08  |s16×4 |SUM |q0,q1,q2,q3各乘10000|
|ROL参数 |3E  |A1    |06  |s16×3 |SUM |ROL通道控制器参数×1000|
|ROL状态 |3E  |A2    |06  |s16×3 |SUM |ROL通道状态参数×100|
|PIT参数 |3E  |A3    |06  |s16×3 |SUM |PIT通道控制器参数×1000|
|PIT状态 |3E  |A4    |06  |s16×3 |SUM |PIT通道状态参数×100|
|遥控指令|3E  |AA    |08  |s16×4 |SUM |遥控器4个通道的控制信号|

|-   |BIT7|BIT6|BIT5    |BIT4|BIT3|BIT2|BIT1|BIT0|
|-   |-   |-   |-       |-   |-   |-   |-   |-   |
|stat|异常|-   |速度模式|-   |-   |-   |-   |解锁|

示例: 3E 01 03 81 0F 00 D2 表示飞控发送状态数据,已侧翻,已解锁,电压3.840V

注:功能字AA为外部遥控信号输入，来自于与其它数据帧不同的串口。

### 地面站->飞控

|帧名称 |帧头|功能字|长度|数据 |校验|备注|
|-      |-   |-     |-   |-    |-   |-|
|状态   |3C  |01    |02  |u8×2 |SUM |指令(stat),控制密码|
|遥控   |3C  |08    |08  |s16×4|SUM |遥控器4个通道的控制信号|
|读参数 |3C  |A0    |01  |u8×2 |SUM |请求读取参数(req1,req2)|
|ROL参数|3C  |A1    |06  |s16×3|SUM |写入ROL通道控制器参数×1000|
|PIT参数|3C  |A3    |06  |s16×3|SUM |写入PIT通道控制器参数×1000|

|-   |BIT7      |BIT6    |BIT5  |BIT4|BIT3 |BIT2  |BIT1 |BIT0 |
|-   |-         |-       |-     |-   |-    |-     |-    |-    |
|stat|速度      |姿态    |-     |-   |-    |-     |-    |解锁 |
|req1|-         |-       |四元数|油门|遥控 |传感器|姿态 |状态 |
|req2|陀螺仪校准|加计校准|-     |-   |P状参|P控参 |R状参|R控参|

示例: 3C 01 02 01 48 88 表示请求解锁,飞机解锁密码0x48

注:stat的BIT7和BIT6为10时设置为速度模式,为01时设置为姿态模式,其它情况无效

## 飞行控制
1. 用键盘进行飞行控制的方法:

WSAD和IKJL

2. 用航模遥控器进行控制的方法:

另外需要处理器将接收机的PWM信号转换成UART数据通过另外一个串口输入至地面站

## BUG
* 使用蓝牙串口时存在部分延迟卡顿等问题